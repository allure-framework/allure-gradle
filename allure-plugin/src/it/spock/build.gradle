plugins {
    id 'groovy'
    id 'io.qameta.allure'
}

allure {
    aspectjweaver = true

    useSpock {
    }
}

repositories {
    mavenCentral()
}

configurations {
    groovy4
}

dependencies {
    groovy4 'org.apache.groovy:groovy:4.0.21'
    testImplementation 'org.spockframework:spock-core:2.3-groovy-4.0'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

tasks.withType(org.gradle.api.tasks.compile.GroovyCompile).configureEach {
    // Ensure Groovy 4 compiler is used for test Groovy sources (supports Java 21, classfile version 65)
    if (name.toLowerCase().contains("test")) {
        groovyClasspath = files(configurations.groovy4) + groovyClasspath
    }
}

test {
    // Spock 2 runs on JUnit Platform
    useJUnitPlatform()
}
